[{"id":"11afc984.5be726","type":"tab","label":"Reading Dashboard","disabled":false,"info":""},{"id":"620ecfac.c9d1","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":11,"width":4,"height":4,"gtype":"gage","title":"Wind speed","label":"m/s","format":"{{value}}","min":0,"max":"120","colors":["#00b500","#e6e600","#ca3838"],"seg1":"40","seg2":"80","x":1810,"y":320,"wires":[]},{"id":"a7e5e596.fe29b8","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":18,"width":4,"height":4,"gtype":"gage","title":"Temperature","label":"C","format":"{{value}}","min":"-30","max":"70","colors":["#7ef3fb","#00b500","#ca3838"],"seg1":"10","seg2":"40","x":1810,"y":360,"wires":[]},{"id":"28e425da.f5f64a","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":12,"width":4,"height":4,"gtype":"gage","title":"Relative humidity","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1830,"y":400,"wires":[]},{"id":"8e439802.f5fbe8","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":19,"width":4,"height":4,"gtype":"wave","title":"Rain amount","label":"mm/day","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"3","seg2":"6","x":1810,"y":440,"wires":[]},{"id":"115fc570.def7bb","type":"switch","z":"11afc984.5be726","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"timestamp","vt":"str"},{"t":"eq","v":"sensor_id","vt":"str"},{"t":"eq","v":"long_rot","vt":"str"},{"t":"eq","v":"tran_rot","vt":"str"},{"t":"eq","v":"wind","vt":"str"},{"t":"eq","v":"temp_air","vt":"str"},{"t":"eq","v":"relh_air","vt":"str"},{"t":"eq","v":"rain","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":1570,"y":280,"wires":[["f2075abb.385828"],["e70cee63.8a98"],["9749c3b2.19c34"],["e34dfe55.b2af"],["620ecfac.c9d1"],["a7e5e596.fe29b8"],["28e425da.f5f64a"],["8e439802.f5fbe8"]]},{"id":"5ecea784.469c18","type":"split","z":"11afc984.5be726","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":1450,"y":280,"wires":[["115fc570.def7bb"]]},{"id":"9749c3b2.19c34","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":9,"width":4,"height":4,"gtype":"gage","title":"Longitudinal rotation","label":"°","format":"{{value}}","min":"-90","max":"90","colors":["#ca3838","#00e608","#ca3838"],"seg1":"-5","seg2":"5","x":1840,"y":200,"wires":[]},{"id":"e34dfe55.b2af","type":"ui_gauge","z":"11afc984.5be726","name":"","group":"e880180c.5e45f8","order":16,"width":4,"height":4,"gtype":"gage","title":"Transversal rotation","label":"°","format":"{{value}}","min":"-90","max":"90","colors":["#ca3838","#0ec42c","#ca3838"],"seg1":"-5","seg2":"5","x":1830,"y":240,"wires":[]},{"id":"a13837aa.d728a8","type":"ui_text","z":"11afc984.5be726","group":"e880180c.5e45f8","order":5,"width":4,"height":1,"name":"Rotations","label":"<i class=\"fa fa-refresh\"></i>","format":"Rotations","layout":"col-center","x":2040,"y":220,"wires":[]},{"id":"9e2a9bb9.20bc08","type":"ui_text","z":"11afc984.5be726","group":"e880180c.5e45f8","order":7,"width":4,"height":1,"name":"Weather","label":"<i class=\"fa fa-cloud\"></i>","format":"Weather","layout":"col-center","x":2040,"y":380,"wires":[]},{"id":"489eccef.d05fd4","type":"comment","z":"11afc984.5be726","name":"Readings' Dashboard","info":"","x":500,"y":60,"wires":[]},{"id":"e70cee63.8a98","type":"ui_text","z":"11afc984.5be726","group":"e880180c.5e45f8","order":1,"width":5,"height":1,"name":"","label":"sensor number:","format":"{{msg.payload}}","layout":"col-center","x":1820,"y":140,"wires":[]},{"id":"f2075abb.385828","type":"ui_text","z":"11afc984.5be726","group":"e880180c.5e45f8","order":3,"width":7,"height":1,"name":"","label":"Last values received at:","format":"{{msg.payload}}","layout":"col-center","x":1850,"y":100,"wires":[]},{"id":"733270cd.006ae","type":"comment","z":"11afc984.5be726","name":"Simulation Info texts","info":"","x":390,"y":360,"wires":[]},{"id":"6400b9cb.07a5b8","type":"comment","z":"11afc984.5be726","name":"Readings Info texts","info":"","x":390,"y":460,"wires":[]},{"id":"cc9ca9b7.9039b8","type":"ui_table","z":"11afc984.5be726","group":"7e1253e1.ee2acc","name":"Measures List","order":1,"width":"20","height":"10","columns":[{"field":"sensor_id","title":"Sensor ID","width":"9%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"timestamp","title":"Timestamp","width":"12%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"long_rot","title":"Longitudinal rotation","width":"18%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"tran_rot","title":"Transversal rotation","width":"15%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"wind","title":"Wind speed","width":"10%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"temp_air","title":"Temperature","width":"11%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"relh_air","title":"Relative humidity","width":"14%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"rain","title":"Rain amount","width":"11%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":1300,"y":600,"wires":[]},{"id":"308ce930.f0cd76","type":"ui_ui_control","z":"11afc984.5be726","name":"INIT on tab change","events":"change","x":130,"y":440,"wires":[["46174574.c8e09c","17c09049.89bef","631a172a.31bdf8","e0109084.cd82d"]]},{"id":"46174574.c8e09c","type":"function","z":"11afc984.5be726","name":"SELECT measures FROM DB","func":"\ncommand = \"SELECT * FROM measures\"\n\nmsg.payload = command\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":600,"wires":[["8a8840f6.8d12a"]]},{"id":"c27baf69.fdf53","type":"comment","z":"11afc984.5be726","name":"History of measurements","info":"","x":410,"y":560,"wires":[]},{"id":"dc89d8b1.ee5778","type":"ui_table","z":"11afc984.5be726","group":"18f79e2c.768552","name":"Sensors list","order":2,"width":7,"height":3,"columns":[{"field":"sensor_id","title":"Sensor ID","width":"26%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"timestamp","title":"Last reading","width":"35%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"last_malfunction","title":"Last malfunction","width":"39%","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":1310,"y":280,"wires":[["5ecea784.469c18"]]},{"id":"71c6aede.f7e5e","type":"ui_button","z":"11afc984.5be726","name":"Add sensor","group":"18f79e2c.768552","order":1,"width":7,"height":1,"passthru":false,"label":"","tooltip":"","color":"#00FF00","bgcolor":"#008080","icon":"add","payload":"","payloadType":"date","topic":"topic","topicType":"msg","x":110,"y":120,"wires":[["d380a6fd.cb8ba8"]]},{"id":"d380a6fd.cb8ba8","type":"function","z":"11afc984.5be726","name":"INSERT sensors INTO DB","func":"A = global.get(\"sensor_num\") + 1\nglobal.set(\"sensor_num\", A)\n\ncommand = \"INSERT INTO sensors (sensor_id, last_malfunction) VALUES (\"\n\ncommand += A + \", \"\n        +  null + \")\"\n        \nmsg.payload = command\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":120,"wires":[["fd4ae913.235d18"]]},{"id":"e0109084.cd82d","type":"function","z":"11afc984.5be726","name":"SELECT sensors FROM DB","func":"\ncommand = \"SELECT sensors.sensor_id, long_rot, tran_rot, wind, temp_air, relh_air, rain, \" \ncommand += \"last_malfunction, MAX(timestamp) AS timestamp FROM sensors \"\ncommand += \"LEFT JOIN measures ON sensors.sensor_id = measures.sensor_id \"\ncommand += \"GROUP BY sensors.sensor_id \"\n\n\nmsg.payload = command\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":280,"wires":[["f2b2fbb2.5aac98"]]},{"id":"17c09049.89bef","type":"ui_template","z":"11afc984.5be726","group":"3517266d.d4724a","name":" Simulation Info text","order":1,"width":7,"height":"6","format":"<table>\n\n<tr>\n<td style=\"width:6%\"> </td>\n<td style=\"width:37%\"> </td>\n<td style=\"text-align:center\">\n    <ng-md-icon icon=\"info\" style=\"fill: #008080\" size=\"24\"></ng-md-icon>\n</td>\n<td style=\"width:43%\"> </td>\n</tr>\n\n<tr><td colspan=\"4\">\nUsing this tab it is possible to simulate a sensor reading.\n</td></tr>\n\n<tr><td colspan=\"4\">\nEvery possibile sensor value is customizable between its valid minimum \nand maximum values.\n</td></tr>\n\n<tr>\n<td style=\"width:6%\">•</td>    \n<td colspan=\"3\">\nThe <span style=\"color: #00FF00;background: #000000\">green send button</span> will insert the readings into the database.\n</td></tr>\n\n<tr>\n<td style=\"width:6%\">•</td>   \n<td colspan=\"3\">\nThe <span style=\"color: #FF0000;background: #000000\">red malfunction button</span> can simulate the possibility of random \nfailures.\n</td></tr>\n\n<tr>\n<td style=\"width:6%\">•</td>\n<td colspan=\"3\">\nThe <span style=\"color: white;background: #000000\">white reset button</span> resets the values to their default, \nfixing any malfunction in the process.\n</td></tr>\n\n<tr><td colspan=\"4\">\nLastly, <b>any</b> change of tab will <b>reset</b> the simulation to default values.\n</td></tr>\n\n</table>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":true,"templateScope":"local","x":390,"y":400,"wires":[[]]},{"id":"631a172a.31bdf8","type":"ui_template","z":"11afc984.5be726","group":"cfc48e68.8d0e5","name":"Readings Info text","order":1,"width":7,"height":6,"format":"<table>\n\n<tr><td style=\"width: 40%\"></td>\n<td style=\"text-align:center\">\n<ng-md-icon icon=\"info\" style=\"fill: #008080\" size=\"24\"></ng-md-icon>\n</td>\n<td style=\"width: 40%\"></td> \n\n<tr><td colspan=\"3\">\nUsing this tab it is possible to visualize the last reading of all sensors in \nthe system.\n</td></tr>\n\n<tr><td colspan=\"3\">\nThe list shows sensor_ID, last timestamp of that sensor's reading and last \ntimestamp of that sensor's reading that didn't contain a value for all sensors, \n<span style=\"text-decoration:underline\">representing a malfunction</span>.\n</td></tr>\n\n<tr><td colspan=\"3\">\nAny empty entry represents a sensor for which no correct timestamp could be found \nin the database, \n<span style=\"text-decoration:underline\">for example a newly inserted sensor</span>.\n</td></tr>\n\n<tr><td colspan=\"3\">\nThe <span style=\"color: #00FF00;background: #000000\">green + button</span> at the \ntop of the list will add a new sensor to the database.\n</td></tr>\n\n<tr><td colspan=\"3\">\nWhen clicking on one entry of the list, its sensor reading will be shown on the gauges.\n</td></tr>\n\n</table>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":true,"templateScope":"local","x":390,"y":500,"wires":[[]]},{"id":"fd4ae913.235d18","type":"mqtt out","z":"11afc984.5be726","name":"","topic":"TDB/Database/INSERT-UPDATE","qos":"","retain":"","broker":"65126e38.f3208","x":680,"y":120,"wires":[]},{"id":"299a5f70.6c422","type":"mqtt in","z":"11afc984.5be726","name":"","topic":"TDB/Database/INSERT-UPDATE-return","qos":"0","datatype":"json","broker":"65126e38.f3208","x":190,"y":200,"wires":[["e0109084.cd82d"]]},{"id":"d819aa19.bad258","type":"mqtt in","z":"11afc984.5be726","name":"","topic":"TDB/Database/SELECT/measures-return","qos":"0","datatype":"json","broker":"65126e38.f3208","x":1040,"y":600,"wires":[["cc9ca9b7.9039b8"]]},{"id":"8a8840f6.8d12a","type":"mqtt out","z":"11afc984.5be726","name":"","topic":"TDB/Database/SELECT/measures","qos":"","retain":"","broker":"65126e38.f3208","x":700,"y":600,"wires":[]},{"id":"f2b2fbb2.5aac98","type":"mqtt out","z":"11afc984.5be726","name":"","topic":"TDB/Database/SELECT/sensors","qos":"","retain":"","broker":"65126e38.f3208","x":710,"y":280,"wires":[]},{"id":"289e5d09.78a872","type":"mqtt in","z":"11afc984.5be726","name":"","topic":"TDB/Database/SELECT/sensors-return","qos":"0","datatype":"json","broker":"65126e38.f3208","x":1030,"y":280,"wires":[["dc89d8b1.ee5778"]]},{"id":"e880180c.5e45f8","type":"ui_group","name":"Gauges","tab":"2c91f384.f52dfc","order":2,"disp":true,"width":"13","collapse":false},{"id":"7e1253e1.ee2acc","type":"ui_group","name":"Past Sensor Readings","tab":"ba34c212.a4d14","order":1,"disp":true,"width":"20","collapse":false},{"id":"18f79e2c.768552","type":"ui_group","name":"Sensors List","tab":"2c91f384.f52dfc","order":1,"disp":true,"width":"7","collapse":false},{"id":"3517266d.d4724a","type":"ui_group","name":"Simulation Info","tab":"27392637.24c19a","order":3,"disp":true,"width":7,"collapse":false},{"id":"cfc48e68.8d0e5","type":"ui_group","name":"Readings Info","tab":"2c91f384.f52dfc","order":3,"disp":true,"width":7,"collapse":false},{"id":"65126e38.f3208","type":"mqtt-broker","name":"","broker":"test.mosquitto.org","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"2c91f384.f52dfc","type":"ui_tab","name":"Last Readings","icon":"network_check","order":2,"disabled":false,"hidden":false},{"id":"ba34c212.a4d14","type":"ui_tab","name":"Readings History","icon":"history","order":3,"disabled":false,"hidden":false},{"id":"27392637.24c19a","type":"ui_tab","name":"Sensor Simulation","icon":"fa-sliders","order":1,"disabled":false,"hidden":false}]